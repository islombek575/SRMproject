{% extends "base.html" %}
{% load humanize %}
{% block content %}
<div class="container mt-4">
  <h3>ðŸ’³ Nasiya tafsilotlari</h3>

        {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <p><b>Mijoz:</b> {{ credit.customer.name|default:"-" }}</p>
      <p><b>Umumiy summa:</b> {{ credit.amount|floatformat:2|intcomma }}</p>
      <p><b>Toâ€˜langan:</b> {{ credit.paid_amount|floatformat:2|intcomma }}</p>
      <p><b>Qoldiq:</b> {{ credit.outstanding_amount|floatformat:2|intcomma }}</p>
      <p><b>Status:</b> {{ credit.get_status_display }}</p>
      <p><b>Sana:</b> {{ credit.created_at|date:"Y-m-d H:i" }}</p>
    </div>
  </div>

  <h5>ðŸ“Œ Toâ€˜lov qoâ€˜shish</h5>
  <form method="post" class="row g-2 mb-3">
    {% csrf_token %}
    <div class="col-md-4">
      <input type="number" step="0.01" name="amount" class="form-control" placeholder="Summani kiriting">
    </div>
    <div class="col-md-4">
      <input type="text" name="note" class="form-control" placeholder="Izoh (ixtiyoriy)">
    </div>
    <div class="col-md-2">
      <button class="btn btn-success w-100">ðŸ’µ Toâ€˜lash</button>
    </div>
  </form>

  <h5>ðŸ“Š Toâ€˜lovlar tarixi</h5>
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <table class="table table-sm mb-0">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Summa</th>
            <th>Kim toâ€˜ladi</th>
            <th>Izoh</th>
            <th>Sana</th>
          </tr>
        </thead>
        <tbody>
          {% for p in credit.payments.all %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ p.amount|floatformat:2|intcomma }}</td>
              <td>{{ p.paid_by.username|default:"-" }}</td>
              <td>{{ p.note|default:"-" }}</td>
              <td>{{ p.created_at|date:"Y-m-d H:i" }}</td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-center">ðŸš« Toâ€˜lovlar yoâ€˜q</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
